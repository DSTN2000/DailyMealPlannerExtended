<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:DailyMealPlannerExtended.ViewModels"
             xmlns:converters="using:DailyMealPlannerExtended.Converters"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="DailyMealPlannerExtended.Views.History.HistoryView"
             x:DataType="vm:HistoryViewModel"
             x:CompileBindings="True"
             Background="Transparent">

    <UserControl.Resources>
        <converters:CalendarDaySnapshotColorConverter x:Key="CalendarDaySnapshotColorConverter"/>
    </UserControl.Resources>

    <Design.DataContext>
        <vm:HistoryViewModel/>
    </Design.DataContext>

    <Grid Margin="16">
        <Border CornerRadius="16"
               Background="{DynamicResource MaterialCardBackgroundBrush}"
               BorderThickness="1"
               BorderBrush="{DynamicResource MaterialDividerBrush}"
               Padding="24">
            <Grid RowDefinitions="Auto,*">
                <!-- Header -->
                <StackPanel Grid.Row="0" Spacing="4" Margin="0,0,0,20">
                    <TextBlock Text="Meal Plan History"
                              FontSize="24"
                              FontWeight="Bold"/>
                    <TextBlock Text="Select a date to view or edit your meal plan"
                              FontSize="14"
                              Opacity="0.7"/>
                </StackPanel>

                <!-- Calendar wrapped in Viewbox to scale and fill available space -->
                <Viewbox Grid.Row="1"
                        Stretch="Uniform"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                    <Calendar SelectedDate="{Binding SelectedDate, Mode=TwoWay}"
                             DisplayDateEnd="{Binding Today}"
                             FirstDayOfWeek="Monday">
                        <Calendar.Styles>
                            <!-- Style calendar day buttons to show snapshot progress colors -->
                            <Style Selector="CalendarDayButton">
                                <Setter Property="Background">
                                    <MultiBinding Converter="{StaticResource CalendarDaySnapshotColorConverter}">
                                        <Binding x:DataType="CalendarDayButton"/>
                                        <Binding Path="$parent[UserControl].DataContext.MealPlanViewModel"/>
                                    </MultiBinding>
                                </Setter>
                            </Style>
                        </Calendar.Styles>
                    </Calendar>
                </Viewbox>
            </Grid>
        </Border>
    </Grid>
</UserControl>
